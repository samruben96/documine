# generated: 2025-11-28
# project: sams-tool
# tracking_system: file-system
# story_location: '{project-root}/docs/sprint-artifacts'

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic exists in epic file but not contexted
#   - contexted: Next epic tech context created by *epic-tech-context (required)
#   - future: Deferred post-MVP work (tracked but not scheduled)
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - drafted: Story file created in stories folder by *create-story
#   - ready-for-dev: Draft approved and story context created by *story-ready
#   - in-progress: Developer actively working on implementation by *dev-story
#   - review: Implementation complete, ready for review by *code-review
#   - done: Story completed by *story-done
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - completed: Retrospective has been done by *retrospective
#
# WORKFLOW NOTES:
# ===============
# - Epics should be 'contexted' before stories can be 'drafted'
# - SM typically drafts next story ONLY after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', dev reviews, then Dev moves to 'done'

generated: 2025-11-28
project: sams-tool
tracking_system: file-system
story_location: '{project-root}/docs/sprint-artifacts'

development_status:
  # Epic 1: Foundation & Infrastructure
  epic-1: done
  1-1-project-initialization-core-setup: done
  1-2-database-schema-rls-policies: done
  1-3-supabase-client-configuration: done
  1-4-storage-bucket-configuration: done
  1-5-error-handling-logging-patterns: done
  1-6-deployment-pipeline-setup: done
  epic-1-retrospective: completed

  # Pre-Epic Technical Debt (Must complete before Epic 2)
  0-1-test-framework-setup: done

  # Epic 2: User Authentication & Onboarding
  epic-2: done
  2-1-signup-page-agency-creation: done
  2-2-post-signup-agency-user-record-creation: done
  2-3-login-page: done
  2-4-session-management-auth-middleware: done
  2-5-password-reset-flow: done
  2-6-user-profile-management: done
  epic-2-retrospective: done

  # Epic 3: Agency & Team Management
  epic-3: done
  3-1-agency-settings-page: done
  3-2-invite-users-to-agency: done
  3-3-manage-team-members: done
  3-4-subscription-billing-management: done
  3-5-agency-usage-metrics: done
  3-6-settings-ux-enhancements: done
  epic-3-retrospective: completed

  # Epic 4: Document Upload & Management
  epic-4: done
  4-1-document-upload-zone: done
  4-2-upload-progress-status-feedback: done
  4-3-document-list-view: done
  4-4-delete-documents: done
  4-5-document-organization-rename-label: done
  4-6-document-processing-pipeline-llamaparse: done
  4-7-processing-queue-management: done
  # Story 4.8 added post-retrospective based on LlamaParse issues (2025-11-30)
  4-8-migrate-document-processing-to-docling: done
  epic-4-retrospective: completed

  # Epic 5: Document Q&A with Trust Transparency
  epic-5: done
  5-1-chat-interface-layout-split-view: done
  5-2-natural-language-query-input: done
  5-3-ai-response-with-streaming-trust-elements: done
  5-4-source-citation-display: done
  5-5-document-viewer-with-highlight-navigation: done
  5-6-conversation-history-follow-up-questions: done
  5-7-responsive-chat-experience: done
  # Stories 5.8-5.10 added based on RAG optimization research (2025-12-01)
  # Story files drafted with full specifications
  5-8-retrieval-quality-optimization: done
  # Story 5.8.1 added as bug fix (2025-12-02)
  # Fixes large document processing timeouts and adds file size validation
  # REVIEWED 2025-12-02: Approved - test fix applied during review
  5-8-1-large-document-processing: done
  5-9-chunking-optimization: done
  5-10-model-evaluation: done
  # Story 5.11 added as bug fix (2025-12-01)
  # Fixes streaming memory leaks, AI personality, and greeting handling
  5-11-streaming-ai-personality-bugfix: done
  # Story 5.12 added as enhancement (2025-12-02)
  # Visual progress tracking for document processing
  # UX Design COMPLETE (Party Mode 2025-12-02), Context validated 2025-12-02
  # Infrastructure fix applied 2025-12-02: Realtime + RLS policy for client access
  # CODE REVIEWED 2025-12-02: Approved - clean implementation, all AC met
  5-12-processing-progress-visualization: done
  # Story 5.13 added as bug fix (2025-12-02)
  # Docling PDF parsing robustness - handles libpdfium page-dimensions errors
  # Context created 2025-12-02: 5-13-docling-pdf-robustness.context.xml
  # IMPLEMENTED 2025-12-02: Phase 1 (P0) + Phase 2 (P1) complete
  # Phase 3 (pypdfium2 backend) deferred to Future Epic F3
  # CODE REVIEWED 2025-12-02: APPROVED - all ACs verified, all tasks complete
  5-13-docling-pdf-robustness: done
  # Story 5.14 added as polish (2025-12-02)
  # Fixes progress jumping and delete not reflecting in realtime
  # Context created 2025-12-02: 5-14-realtime-polish.context.xml
  # IMPLEMENTED 2025-12-02: Monotonic progress, optimistic delete, connection indicator
  # CODE REVIEWED 2025-12-02: APPROVED - all ACs verified
  5-14-realtime-polish: done
  # Mini-retro (5.1-5.6) completed 2025-12-01: docs/sprint-artifacts/retrospectives/epic-5-retro-2025-12-01.md
  # Doc update session completed 2025-12-02 (Party Mode - epics.md, architecture.md)
  # FULL Epic 5 retrospective completed 2025-12-02: docs/sprint-artifacts/retrospectives/epic-5-full-retrospective.md
  # Identified 4 bugs requiring cleanup before proceeding to Quote Comparison
  epic-5-retrospective: completed

  # Epic 6: Epic 5 Cleanup & Stabilization + UI Polish
  # Source: Epic 5 Full Retrospective + Party Mode UI Exploration - 2025-12-02
  # Reason: 4 bugs + 5 UI polish items undermining trust transparency UX
  # Tech Spec: docs/sprint-artifacts/epics/epic-6/tech-spec.md
  # Research: docs/research-ui-best-practices-2025-12-02.md
  epic-6: done
  # Story 6.1: Fix Conversation Loading (406 Error)
  # RLS policy allows INSERT but not SELECT - users can't load their conversations
  # Priority: P0 - blocks other testing
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/epics/epic-6/stories/story-6.1-fix-conversation-loading-406.md
  # CONTEXT 2025-12-02: Context file created at docs/sprint-artifacts/epics/epic-6/stories/6-1-fix-conversation-loading-406.context.xml
  # IMPLEMENTED 2025-12-02: Fixed .single() to .maybeSingle(), Playwright E2E test added
  # CODE REVIEWED 2025-12-02: APPROVED - all ACs verified, all tasks complete
  6-1-fix-conversation-loading-406: done
  # Story 6.2: Fix Confidence Score Calculation
  # Cohere reranker scores replace vector similarity - wrong thresholds
  # Priority: P0 - core trust feature broken
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/epics/epic-6/stories/story-6.2-fix-confidence-score-calculation.md
  # CONTEXT 2025-12-02: Context file created at docs/sprint-artifacts/epics/epic-6/stories/6-2-fix-confidence-score-calculation.context.xml
  # Party Mode verified: rerankerScore exists, bug at reranker.ts:114, one-line deletion + confidence update
  # IMPLEMENTED 2025-12-02: Fixed reranker.ts bug, dual-threshold logic, conversational badge
  # CODE REVIEWED 2025-12-02: APPROVED - all 6 ACs verified, all 6 tasks verified complete
  6-2-fix-confidence-score-calculation: done
  # Story 6.3: Fix Source Citation Navigation
  # Clicking citation doesn't scroll PDF to referenced page
  # Priority: P1 - UX broken but not blocking
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/epics/epic-6/stories/story-6.3-fix-source-citation-navigation.md
  # CONTEXT 2025-12-02: Context file created at docs/sprint-artifacts/epics/epic-6/stories/6-3-fix-source-citation-navigation.context.xml
  # IMPLEMENTED 2025-12-03: Fixed dual-instance rendering, scrollToPage with getBoundingClientRect
  # Root cause: TWO DocumentViewer instances in DOM, ref attached to hidden one
  # Fix: Conditional rendering with useIsMobile() hook - only ONE instance exists
  # CODE REVIEWED 2025-12-03: APPROVED - all 5 ACs verified, architectural fix correct
  6-3-fix-source-citation-navigation: done
  # Story 6.4: DEFERRED to Future Epic F4
  # Moved 2025-12-02: Mobile optimization not priority for MVP
  # See: epic-f4-mobile-optimization
  # Story 6.5: Remove Stale UI Text & Fix Page Title (NEW - UI Polish)
  # "Coming in Epic 5" text and "Create Next App" page title
  # Priority: P0 - embarrassment fix, XS effort
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/epics/epic-6/stories/story-6.5-remove-stale-text-fix-title.md
  # IMPLEMENTED 2025-12-02: Fixed page title, removed stale Epic references, dynamic doc titles
  6-5-remove-stale-text-fix-title: done
  # Story 6.6: Connection Status & Realtime Indicator (NEW - UI Polish)
  # "Connecting..." never resolves to meaningful state
  # Priority: P1 - user feedback improvement, S effort
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/epics/epic-6/stories/story-6.6-connection-status-indicator.md
  # CONTEXT 2025-12-02: Context file created at docs/sprint-artifacts/epics/epic-6/stories/6-6-connection-status-indicator.context.xml
  6-6-connection-status-indicator: done
  # Story 6.7: Document List UX Polish (COMBINED - UI Polish)
  # Combined 2025-12-02: Merged original 6.7, 6.8, 6.9 into single story
  # Includes: selection highlight, empty state UX, filename tooltips
  # Priority: P1 - UX polish
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/epics/epic-6/stories/story-6.7-document-list-ux-polish.md
  # CONTEXT 2025-12-02: Context file created at docs/sprint-artifacts/epics/epic-6/stories/6-7-document-list-ux-polish.context.xml
  # IMPLEMENTED 2025-12-02: Selection highlight, empty states, filename tooltips
  # 19 unit tests pass, E2E test created
  # CODE REVIEWED 2025-12-03: Approved and merged
  6-7-document-list-ux-polish: done
  # Story 6.8: Design System Refresh (NEW - Visual Polish)
  # User feedback: "Too grey, doesn't feel modern"
  # Introduces brand accent color, fixes spacing, modernizes look
  # Priority: P1 - UX enhancement
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/epics/epic-6/stories/story-6.8-design-system-refresh.md
  # CONTEXT 2025-12-03: Context file created at docs/sprint-artifacts/epics/epic-6/stories/6-8-design-system-refresh.context.xml
  # PHASE 1 DONE 2025-12-03: Electric Blue accent, button hover effects, spacing fixes, dark mode
  # PHASE 2 DONE 2025-12-03: UX Audit enhancements - 12 ACs implemented
  # Phase 2 includes: resizable panels, markdown chat, dockable chat
  # Phase 2 includes: mobile header fix, nav active state, auth page visuals, card depth
  # AC-6.8.18 (Source Text Highlighting) moved to Future Epic F5
  # CODE REVIEWED 2025-12-03: APPROVED - All ACs verified, ready to merge
  6-8-design-system-refresh: done
  # RETROSPECTIVE 2025-12-03: docs/sprint-artifacts/retrospectives/epic-6-full-retrospective.md
  # Key learnings: Supabase .maybeSingle(), score semantics, conditional rendering
  # All Epic 5 bugs fixed, Design System Refresh complete, A- grade
  epic-6-retrospective: completed

  # Epic 7: Quote Comparison (RENUMBERED from Epic 6)
  # Moved to Epic 7 to allow Epic 5 cleanup first
  # Tech Spec: docs/sprint-artifacts/epics/epic-7/tech-spec.md
  epic-7: done
  # Story 7.1: Quote Selection Interface
  # Foundation for comparison feature: selection UI + database migrations
  # Priority: P0 - foundation for all other Epic 7 stories
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/epics/epic-7/stories/story-7.1-quote-selection-interface.md
  # CONTEXT 2025-12-03: Context file with UX Designer guidance at docs/sprint-artifacts/epics/epic-7/stories/7-1-quote-selection-interface.context.xml
  # IMPLEMENTED 2025-12-03: All 8 ACs complete, 38 unit tests + E2E tests pass
  # Database: quote_extractions and comparisons tables with RLS policies
  # Components: QuoteSelector, SelectionCounter, /compare page, /compare/[id] page
  # API: POST /api/compare endpoint for creating comparisons
  # CODE REVIEWED 2025-12-03: APPROVED - all 7 ACs verified, security reviewed
  7-1-quote-selection-interface: done
  # Story 7.2: Quote Data Extraction
  # GPT-5.1 structured outputs with zodResponseFormat for data extraction
  # Priority: P0 - core extraction service, all downstream stories depend on this
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/epics/epic-7/stories/story-7.2-quote-data-extraction.md
  # CONTEXT 2025-12-03: Context file created at docs/sprint-artifacts/epics/epic-7/stories/7-2-quote-data-extraction.context.xml
  # IMPLEMENTED 2025-12-03: ExtractionService with GPT-5.1 + zodResponseFormat
  # Refactored from function calling to structured outputs for guaranteed schema compliance
  # Types: src/types/compare.ts, Cache: extraction.ts, API: POST+GET /api/compare
  # UI: Comparison result page with polling, extraction cards
  # Tests: 21 unit tests for extraction schema validation
  # Build passes, all 924 tests pass
  # Future consideration: @openai/agents SDK for multi-agent workflows (Epic F8)
  # CODE REVIEWED 2025-12-03: APPROVED - all 8 ACs verified, 21 tests, excellent quality
  7-2-quote-data-extraction: done
  # Story 7.3: Comparison Table View
  # Side-by-side table with difference highlighting, best/worst indicators
  # Priority: P0 - core comparison visualization
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/epics/epic-7/stories/story-7.3-comparison-table-view.md
  # CONTEXT 2025-12-03: Context file created at docs/sprint-artifacts/epics/epic-7/stories/7-3-comparison-table-view.context.xml
  # IMPLEMENTED 2025-12-03: DiffEngine + ComparisonTable component
  # 64 unit tests (42 diff + 22 component) + 13 E2E tests (39 across browsers)
  # All ACs (7.3.1-7.3.8) implemented with sticky headers, best/worst indicators, difference highlighting
  # CODE REVIEWED 2025-12-03: APPROVED - all 8 ACs verified, all 7 tasks complete, excellent code quality
  7-3-comparison-table-view: done
  # Story 7.4: Gap & Conflict Identification
  # Automatic detection of coverage gaps and conflicts between quotes
  # Priority: P0 - enhances comparison table with intelligent insights
  # DRAFTED 2025-12-03: Story file created
  # CONTEXT 2025-12-03: Context XML generated, ready for development
  # IMPLEMENTED 2025-12-03: All 7 tasks complete, 37 unit tests + E2E spec
  # CODE REVIEWED 2025-12-03: APPROVED - all 6 ACs verified, 59 tests pass, excellent quality
  7-4-gap-conflict-identification: done
  # Story 7.5: Source Citations in Comparison
  # Click-to-verify for any extracted value, reusing document viewer highlight pattern
  # Priority: P0 - trust transparency for comparison data
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/epics/epic-7/stories/story-7.5-source-citations-in-comparison.md
  # CONTEXT 2025-12-03: Context file at docs/sprint-artifacts/epics/epic-7/stories/7-5-source-citations-in-comparison.context.xml
  # IMPLEMENTED 2025-12-03: Source links in table cells, SourceViewerModal with DocumentViewer integration
  # Components: source-viewer-modal.tsx, updated comparison-table.tsx with onSourceClick callback
  # Page navigation works, page-level pulse highlight, inferred value indicators with tooltips
  # Note: Full text highlighting requires bounding box data (deferred to Future Epic F3)
  # 39 unit tests pass, E2E spec created at __tests__/e2e/source-citations.spec.ts
  # CODE REVIEWED 2025-12-03: APPROVED - pushed to git
  7-5-source-citations-in-comparison: done
  # Story 7.6: Export Comparison Results
  # PDF and CSV export for comparison results
  # Priority: P1 - nice to have for MVP, essential for production
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/epics/epic-7/stories/story-7.6-export-comparison-results.md
  # CONTEXT 2025-12-03: Context file at docs/sprint-artifacts/epics/epic-7/stories/7-6-export-comparison-results.context.xml
  # CODE REVIEWED 2025-12-03: APPROVED - 6/6 ACs verified, 7/7 tasks verified, 29 tests
  7-6-export-comparison-results: done
  # Story 7.7: Comparison History (NEW - 2025-12-03)
  # User can view past comparisons, search, delete from history
  # Priority: P1 - UX enhancement, M effort
  # STATUS: UX Designer review required before development
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/epics/epic-7/stories/story-7.7-comparison-history.md
  7-7-comparison-history: done
  # RETROSPECTIVE 2025-12-03: docs/sprint-artifacts/retrospectives/epic-7-retrospective.md
  # Key learnings: zodResponseFormat, story context files, single-day delivery
  # MVP COMPLETE - All 7 epics delivered
  epic-7-retrospective: completed

  # Epic 8: Tech Debt & Production Hardening
  # Source: Epic 7 Retrospective + Supabase Advisors - 2025-12-03
  # Reason: Clean foundation before Phase 2 feature explosion
  # Tech Spec: docs/sprint-artifacts/epics/epic-8/tech-spec.md
  # Supabase Issues Found:
  #   - 8 security advisories (7 function search_path + leaked password protection)
  #   - 37 performance advisories (28 RLS initplan + 8 unindexed FKs + more)
  # NOTE: This epic completed Future Epic F1 (Tech Debt & Optimizations) scope
  epic-8: done
  # Story 8.1: Database Security Hardening
  # Fix function search_path, enable leaked password protection
  # Priority: P0 - security first
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/epics/epic-8/stories/story-8.1-database-security-hardening.md
  # CONTEXT 2025-12-03: Context file created at docs/sprint-artifacts/epics/epic-8/stories/8-1-database-security-hardening.context.xml
  # IMPLEMENTED 2025-12-03: ALL 4 TASKS COMPLETE
  # - Task 1: Migration applied - 7 functions now have SET search_path = public, extensions
  # - Task 2: Leaked password protection enabled via Supabase Dashboard (manual)
  # - Task 3: Verified 0 WARN-level security issues via get_advisors
  # - Task 4: Smoke tests passed - chat and comparison working
  # CODE REVIEWED 2025-12-03: APPROVED - all 3 ACs verified, all 8 tasks verified, 0 security warnings
  8-1-database-security-hardening: done
  # Story 8.2: RLS Policy Performance Optimization
  # Fix 28 RLS policies re-evaluating auth.uid() per row
  # Priority: P0 - performance at scale
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/epics/epic-8/stories/story-8.2-rls-policy-performance.md
  # CONTEXT 2025-12-03: Context file at docs/sprint-artifacts/epics/epic-8/stories/8-2-rls-policy-performance.context.xml
  # IMPLEMENTED 2025-12-03: 28 RLS policies optimized, 0 auth_rls_initplan warnings
  # CODE REVIEWED 2025-12-03: APPROVED - 7/7 ACs verified, 11/11 tasks verified
  8-2-rls-policy-performance: done
  # Story 8.3: Database Index Optimization
  # Add missing FK indexes, evaluate unused indexes
  # Priority: P1 - performance improvement
  # CONTEXT 2025-12-03: Context file at docs/sprint-artifacts/epics/epic-8/stories/8-3-database-index-optimization.context.xml
  # REVIEWED 2025-12-03: Approved - 8 FK indexes added, 7 unused indexes kept with rationale
  8-3-database-index-optimization: done
  # Story 8.4: Consolidate Processing Jobs RLS
  # Fix multiple permissive policies issue
  # Priority: P1 - performance improvement
  # REVIEWED 2025-12-03: Approved - 2 SELECT policies consolidated into 1
  8-4-consolidate-processing-jobs-rls: done
  # Story 8.5: API Rate Limiting
  # 10 comparisons/hr/agency, 100 messages/hr/user
  # Priority: P0 - cost control and abuse prevention
  # REVIEWED 2025-12-03: Approved - rate_limits table, rate-limit.ts, API integration
  8-5-api-rate-limiting: done
  # Story 8.6: Fix Pre-existing Test Failure
  # useAgencyId test - was already fixed, fixed act() warnings
  # Priority: P2 - test reliability
  # REVIEWED 2025-12-03: Approved - test already passing, fixed act() warnings
  8-6-fix-test-failure: done
  # Story 8.7: Code Quality Cleanup
  # Update comments, regenerate types
  # Priority: P3 - housekeeping
  # REVIEWED 2025-12-03: Approved - GPT-4o refs fixed, CLAUDE.md updated, types verified
  8-7-code-quality-cleanup: done
  # RETROSPECTIVE 2025-12-03: docs/sprint-artifacts/retrospectives/epic-8-retrospective.md
  # Key outcomes: 0 security advisories, 0 performance advisories, rate limiting active
  # Next Epic Decision: Epic 9 - One-Pager Generation (builds on Epic 7 extraction)
  epic-8-retrospective: completed

  # Epic 9: One-Pager Generation
  # Source: Epic 8 Retrospective Decision - 2025-12-03
  # Reason: High user value - agents can share professional summaries with clients
  # Tech Spec: docs/sprint-artifacts/epics/epic-9/tech-spec.md
  # UX Research: docs/research-one-pager-ux-2025-12-03.md
  # Total Points: 13 (6 stories)
  # TECH SPEC 2025-12-03: docs/sprint-artifacts/epics/epic-9/tech-spec.md (enhanced with NFRs + traceability)
  epic-9: done
  epic-9-retrospective: completed
  # Story 9.1: Agency Branding
  # Admin-configurable branding (logo, colors, contact info)
  # Priority: P0 - foundation for all one-pager generation
  # DRAFTED 2025-12-03: Story file at docs/sprint-artifacts/epics/epic-9/stories/story-9.1-agency-branding.md
  # CONTEXT 2025-12-03: Context file at docs/sprint-artifacts/epics/epic-9/stories/9-1-agency-branding.context.xml
  # IMPLEMENTED 2025-12-03: All 6 ACs complete
  # - Database migration for branding columns (logo_url, primary_color, secondary_color, phone, branding_email, address, website)
  # - Branding storage bucket with RLS policies
  # - useAgencyBranding hook with logo upload/remove, color/contact update
  # - LogoUpload, ColorPicker, BrandingForm, BrandingTab components
  # - Settings page Branding tab (admin only)
  # - 13 unit tests pass
  9-1-agency-branding: done
  # Story 9.2: Dashboard Page
  # Central hub with agency welcome and tool cards
  # Priority: P0 - navigation improvement
  # DRAFTED 2025-12-03: Story file at docs/sprint-artifacts/epics/epic-9/stories/story-9.2-dashboard-page.md
  # CONTEXT 2025-12-03: Context file at docs/sprint-artifacts/epics/epic-9/stories/9-2-dashboard-page.context.xml
  # IMPLEMENTED 2025-12-03: All 6 ACs complete
  # - /dashboard page with WelcomeHeader and ToolCard components
  # - Time-based greeting with agency name
  # - Three tool cards (Chat with Docs, Quote Comparison, Generate One-Pager)
  # - Redirect from / to /dashboard for authenticated users
  # - Responsive layout (1 col mobile, 3 col desktop)
  # - 16 unit tests pass
  9-2-dashboard-page: done
  # Story 9.3: One-Pager Page
  # Dedicated page with 3 entry points and live preview
  # Priority: P0 - core feature page
  # DRAFTED 2025-12-03: Story file at docs/sprint-artifacts/epics/epic-9/stories/story-9.3-one-pager-page.md
  # CONTEXT 2025-12-04: Context file at docs/sprint-artifacts/epics/epic-9/stories/9-3-one-pager-page.context.xml
  # IMPLEMENTED 2025-12-04: All 9 ACs complete
  # - /one-pager page with 3 entry modes (comparison, document, select)
  # - useOnePagerData hook for fetching comparison/document data
  # - DocumentSelector component (max 4 selections, counter, generate button)
  # - OnePagerForm component (client name max 100, agent notes max 500, debounced)
  # - OnePagerPreview component (live preview matching PDF output)
  # - PDF template with agency branding (downloadOnePagerPdf)
  # - Split layout: form 40%, preview 60% (hidden on mobile)
  # - Download button with filename format: docuMINE-one-pager-YYYY-MM-DD.pdf
  # - 44 unit tests, E2E test suite created
  # CODE REVIEWED 2025-12-04: Ready for merge
  9-3-one-pager-page: done
  # Story 9.4: One-Pager PDF Template
  # @react-pdf/renderer document with agency branding
  # Priority: P0 - PDF generation
  # DRAFTED 2025-12-03: Story file at docs/sprint-artifacts/epics/epic-9/stories/story-9.4-one-pager-pdf-template.md
  # Depends on: 9.1, 9.3
  # IMPLEMENTED 2025-12-04: Added missing AC-9.4.3 (comparison table) and AC-9.4.5 (gaps section)
  # - ComparisonTable component in PDF for multi-quote mode
  # - GapsSection component showing coverage gaps between carriers
  # - Updated OnePagerPreview to match PDF layout for comparison mode
  # - Single-quote mode unchanged (Quote Overview + Coverage Highlights)
  # - Multi-quote mode shows Coverage Comparison table + Gaps section
  9-4-one-pager-pdf-template: done
  # Story 9.5: Entry Point Buttons
  # Buttons on compare, docs, history pages
  # Priority: P1 - navigation convenience
  # DRAFTED 2025-12-03: Story file at docs/sprint-artifacts/epics/epic-9/stories/story-9.5-entry-point-buttons.md
  # Depends on: 9.3
  # IMPLEMENTED 2025-12-04: OnePagerButton component + 3 entry points
  # - Comparison results header, comparison history row actions, document viewer header
  # - 13 component tests pass, build successful
  9-5-entry-point-buttons: done
  # Story 9.6: Testing & Polish
  # Unit, component, E2E tests
  # Priority: P2 - quality assurance
  # DRAFTED 2025-12-03: Story file at docs/sprint-artifacts/epics/epic-9/stories/story-9.6-testing-polish.md
  # Depends on: 9.1-9.5
  # IMPLEMENTED 2025-12-04: Full test coverage verified
  # - Added use-one-pager-data hook tests (11 tests)
  # - Added E2E tests for entry point navigation (12 tests)
  # - Updated CLAUDE.md with Epic 9 patterns
  # - 1207 tests pass, build successful
  9-6-testing-polish: done

# ===========================================
# FUTURE EPICS (Prioritized Post-MVP Roadmap)
# ===========================================
# Priority Order (as of 2025-12-03):
# F1 ✅ (done via Epic 8) → F2 → F3 → F4 → F5 → F6 → F7 → F8

  # Epic F1: Tech Debt & Optimizations
  # COMPLETED VIA EPIC 8 - 2025-12-03
  # Epic 8 addressed the core tech debt items:
  #   - Security: Function search_path hardening, leaked password protection
  #   - Performance: RLS policy optimization (28 policies), FK indexes
  #   - Rate limiting: API abuse prevention
  #   - Code quality: ESLint fixes, type safety
  # Remaining items (accessibility, observability) deferred to future work
  epic-f1-tech-debt-optimizations: done

  # Epic F2: Document Library & Intelligence (RENAMED - 2025-12-04)
  # Source: Sam's feature request - 2025-12-03, expanded 2025-12-04
  # Reason: Better document organization and AI-powered insights
  # Features:
  #   - Dedicated /documents page (full document library)
  #   - Document categorization (general vs quote document)
  #   - AI-powered tagging and short blurbs
  #   - General documents excluded from /compare quotes page
  # Tech Spec: docs/sprint-artifacts/epics/epic-/tech-specf2.md
  epic-f2-document-library-intelligence: contexted
  # Story F2-1: Document Library Page
  # READY-FOR-DEV 2025-12-04: Context at docs/sprint-artifacts/epics/epic-f2/stories/f2-1-document-library-page.context.xml
  # Route restructure: /documents → library, /chat-docs/[id] → viewer
  f2-1-document-library-page: done
  # Story F2-2: Document Categorization Schema
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-f2/stories/story-f2.2-document-categorization-schema.md
  # CONTEXT 2025-12-04: Context file at docs/sprint-artifacts/epics/epic-f2/stories/f2-2-document-categorization-schema.context.xml
  # IMPLEMENTED 2025-12-04: All 5 ACs complete
  # - Database migration: document_type column with CHECK constraint
  # - TypeScript types: DocumentType = 'quote' | 'general'
  # - PATCH API endpoint for type updates
  # - DocumentTypeBadge + DocumentTypeToggle components
  # - DocumentCard integration with optimistic updates
  # - 50 unit tests + 5 E2E tests
  f2-2-document-categorization-schema: done
  # Story F2-3: AI Tagging & Summarization
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-f2/stories/story-f2.3-ai-tagging-summarization.md
  # CONTEXT 2025-12-04: Context file at docs/sprint-artifacts/epics/epic-f2/stories/f2-3-ai-tagging-summarization.context.xml
  # IMPLEMENTED 2025-12-04: All 6 ACs complete
  # - Database migration: ai_summary (text) + ai_tags (text[]) columns with GIN index
  # - AI tagging service: GPT-5.1 structured outputs with json_schema response_format
  # - Edge Function integration: Step 6.5 after chunking, 5-second timeout with AbortController
  # - Graceful degradation: Errors logged but not thrown, processing continues
  # - Document card: AI tags displayed (3 max + "+N" indicator), summary in tooltip
  # - Document viewer: Full tags + summary in header
  # - Search: Filters by document name OR AI tags
  # - 16 unit tests for AI tagging service + 7 component tests + 5 E2E tests
  f2-3-ai-tagging-summarization: done
  # Story F2-4: Filter General Docs from Compare
  # IMPLEMENTED 2025-12-04: All 3 ACs complete
  # - Query filter: document_type.eq.quote,document_type.is.null
  # - TypeScript type updates for document_type
  # - UI note: "Only quote documents shown"
  f2-4-filter-general-docs-from-compare: done
  # Story F2-5: Tag Management UI
  # IMPLEMENTED 2025-12-04: All 6 ACs complete
  # - TagEditor component with add/remove/keyboard shortcuts
  # - API extended to handle ai_tags updates
  # - Document viewer integrated with live editing
  # - Max 10 tags, 30 chars per tag
  f2-5-tag-management-ui: done
  # Story F2-6: Document Library Table View
  # DRAFTED 2025-12-04: Party Mode decision - table for scanability
  # Team consensus: Sally (UX), Winston (Arch), Amelia (Dev), John (PM)
  # IMPLEMENTED 2025-12-04: All 8 ACs complete
  # - DocumentTable component with @tanstack/react-table
  # - Sortable columns: Name, Type, Status, Tags, Date, Pages
  # - Tags overflow with "+N" indicator, tooltips for all
  # - Row hover reveals actions dropdown (Open, Rename, Delete)
  # - Row click navigates to /chat-docs/[id]
  # - Sticky header, keyboard navigation, search preserved
  f2-6-document-library-table-view: done
  # RETROSPECTIVE 2025-12-04: docs/sprint-artifacts/epic-f2-retrospective.md
  # Key outcomes: Document Library page, AI tagging, categorization schema, table view
  # Epic-yolo mode: 6/6 stories in ~1 day, 1 minor bug fixed (dropdown)
  epic-f2-retrospective: completed

  # Epic F3: Document Viewer Enhancements (was F5)
  # Source: Story 6.8 AC-6.8.18 - 2025-12-03
  # Reason: Requires PDF.js text layer work, significant effort
  epic-f3-document-viewer-enhancements: future
  f3-1-source-text-highlighting: future
  f3-2-text-selection-highlighting: future
  f3-3-search-within-document: future

  # Epic F4: Email Infrastructure (was F1)
  # Source: Epic 2 Retrospective - 2025-11-28
  # Reason: Resend requires custom domain setup
  epic-f4-email-infrastructure: future
  f4-1-custom-domain-setup-verification: future
  f4-2-resend-smtp-integration-supabase-auth: future
  f4-3-professional-email-templates: future
  f4-4-delivery-tracking-analytics: future

  # Epic F5: Billing Infrastructure (was F2)
  # Source: Epic 2 Retrospective - 2025-11-28
  # Reason: Simplify MVP, manual tier assignment sufficient
  epic-f5-billing-infrastructure: future
  f5-1-stripe-or-lemonsqueezy-integration: future
  f5-2-subscription-management-ui: future
  f5-3-payment-processing: future
  f5-4-usage-based-billing: future
  f5-5-self-service-plan-changes: future

  # Epic F6: Document Processing Reliability (was F3)
  # Source: Story 5.13 Implementation - 2025-12-02
  # Reason: ~1-2% of PDFs fail with libpdfium page-dimensions errors
  # STATUS: OBSOLETE - 2025-12-05
  # Epic 12 (Google Cloud Document AI) supersedes this epic
  # Document AI provides enterprise-grade reliability without pypdfium2 issues
  epic-f6-document-processing-reliability: obsolete
  f6-1-pypdfium2-backend-evaluation: obsolete
  f6-2-multi-backend-fallback-chain: obsolete
  f6-3-pdf-preprocessing-normalization: obsolete

  # Epic F7: Mobile Optimization (was F4)
  # Source: Epic 6 Story 6.4 - 2025-12-02
  # Reason: Mobile optimization not priority for MVP
  epic-f7-mobile-optimization: future
  f7-1-mobile-tab-state-preservation: future
  f7-2-mobile-responsive-polish: future
  f7-3-touch-gesture-improvements: future

  # Epic F8: Multi-Agent Workflows (NEW - 2025-12-03)
  # Source: Story 7.2 Implementation - 2025-12-03
  # Reason: Complex agentic pipelines using @openai/agents SDK
  # Prerequisites: Currently using zodResponseFormat for single-extraction
  # Potential use cases:
  #   - Quote extraction → comparison → reporting pipeline
  #   - Multi-document analysis with specialized agents per coverage type
  #   - Interactive quote negotiation workflows
  # Reference: https://openai.github.io/openai-agents-js/
  epic-f8-multi-agent-workflows: future
  f8-1-agents-sdk-evaluation: future
  f8-2-extraction-comparison-pipeline: future
  f8-3-multi-agent-coordination: future
  f8-4-guardrails-tracing: future

# ===========================================
# EPIC 10: ENHANCED QUOTE EXTRACTION & ANALYSIS
# ===========================================
# Source: User request - 2025-12-04
# Reason: Agents need comprehensive policy data for thorough quote analysis
# Research: Based on industry checklists from IIAT, IRMI, AmTrust
# Doc: docs/epics/epic-10-enhanced-quote-extraction.md
# Tech Spec: docs/sprint-artifacts/epics/epic-10/tech-spec.md
# Party Mode Input: Winston (Arch), John (PM), Amelia (Dev), Sally (UX), Murat (TEA), Bob (SM), Mary (Analyst)
# Total Points: 26 (11 stories)
# Story Order (per team consensus): 10.1+10.10 → 10.2-10.6 → 10.7 → 10.8-10.9 → 10.11

  # Epic 10: Enhanced Quote Extraction & Analysis
  epic-10: contexted
  # Story 10.1: Extended Coverage Types Schema (3 pts)
  # Add: Cyber, E&O, Workers Comp, Umbrella, EPLI, Pollution, BI, Auto, D&O, Crime
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-10/stories/story-10.1-extended-coverage-types.md
  # CONTEXT 2025-12-04: Context file at docs/sprint-artifacts/epics/epic-10/stories/10-1-extended-coverage-types.context.xml
  # IMPLEMENTED 2025-12-04: All 7 ACs complete, 17 unit tests, build passes
  # CODE REVIEWED 2025-12-04: APPROVED - all ACs verified, ready to merge
  10-1-extended-coverage-types: done
  # Story 10.2: Policy Form & Structure Metadata (2 pts)
  # Extract: ISO form numbers, occurrence vs claims-made, audit provisions, admitted status
  # IMPLEMENTED 2025-12-04: PolicyMetadata interface, policyMetadataSchema Zod, extraction prompt
  10-2-policy-form-metadata: done
  # Story 10.3: Enhanced Limits & Deductibles (2 pts)
  # Add: Aggregate limits, sublimits, SIR, coinsurance, waiting periods
  # IMPLEMENTED 2025-12-04: Extended CoverageItem with 5 new fields, Zod schema updated
  10-3-enhanced-limits-deductibles: done
  # Story 10.4: Endorsements Extraction (3 pts)
  # Extract: CG 20 10, CG 20 37, waiver of subrogation, primary & non-contributory
  # IMPLEMENTED 2025-12-04: Endorsement interface, endorsementSchema Zod, CRITICAL_ENDORSEMENTS constant
  10-4-endorsements-extraction: done
  # Story 10.5: Carrier Information & Ratings (2 pts)
  # Extract: AM Best rating, admitted status, claims contact, underwriter
  # IMPLEMENTED 2025-12-04: CarrierInfo interface, carrierInfoSchema Zod, extraction prompt
  10-5-carrier-information: done
  # Story 10.6: Premium Breakdown (2 pts)
  # Extract: Per-coverage premiums, taxes, fees, broker fees, payment terms
  # IMPLEMENTED 2025-12-04: PremiumBreakdown interface, premiumBreakdownSchema Zod, CoveragePremium
  10-6-premium-breakdown: done
  # Story 10.7: Automated Gap Analysis (3 pts)
  # Identify: Missing coverages, inadequate limits, unusual exclusions, missing endorsements
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-10/stories/story-10.7-automated-gap-analysis.md
  # CONTEXT 2025-12-04: Context file at docs/sprint-artifacts/epics/epic-10/stories/10-7-automated-gap-analysis.context.xml
  # IMPLEMENTED 2025-12-04: All 6 ACs complete
  # - GapAnalysis service: detectMissingCoverages, detectLimitConcerns, detectEndorsementGaps
  # - Risk score calculation: 0-100 weighted (critical=25, recommended=10, limits=15, endorsements=20)
  # - GapConflictBanner: RiskScoreBadge, EndorsementGapItem, LimitConcernItem components
  # - 33 unit tests + 7 component tests + E2E tests
  # CODE REVIEWED 2025-12-04: APPROVED - all 6 ACs verified, excellent code quality
  10-7-automated-gap-analysis: done
  # Story 10.8: Enhanced Comparison Table (2 pts)
  # UI: Endorsement matrix, premium breakdown, carrier ratings, collapsible sections
  # NOTE: Review Story 10.12 - extraction now at upload time, data in documents.extraction_data
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-10/stories/story-10.8-enhanced-comparison-table.md
  # CONTEXT 2025-12-04: Context file at docs/sprint-artifacts/epics/epic-10/stories/10-8-enhanced-comparison-table.context.xml
  # IMPLEMENTED 2025-12-04: All ACs complete - collapsible sections, endorsement matrix, premium breakdown
  # CODE REVIEWED 2025-12-04: APPROVED
  10-8-enhanced-comparison-table: done
  # Story 10.9: Enhanced One-Pager Template (2 pts)
  # PDF: Policy metadata, endorsements summary, premium breakdown, gap highlights
  # NOTE: Review Story 10.12 - extraction now at upload time, instant one-pager generation
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-10/stories/story-10.9-enhanced-one-pager.md
  # CONTEXT 2025-12-04: Context file at docs/sprint-artifacts/epics/epic-10/stories/10-9-enhanced-one-pager.context.xml
  # IMPLEMENTED 2025-12-04: All ACs complete - AM Best Rating, Policy Details, Endorsements, Premium Summary
  # CODE REVIEWED 2025-12-04: APPROVED
  10-9-enhanced-one-pager: done
  # Story 10-audit: Epic 10 Comprehensive Codebase Audit
  # Quality gate before Story 10.11 testing
  # Checks: type schemas, component duplication, code quality, extraction/gap services, UI components
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-10/stories/story-10-audit-epic-10-codebase-audit/story-10-audit-epic-10-codebase-audit.md
  # COMPLETED 2025-12-04: All 8 ACs verified, 1386 tests pass, build successful
  # Findings: docs/sprint-artifacts/epics/epic-10/epic-10-audit-findings.md
  10-audit-epic-10-codebase-audit: done
  # Story 10.10: Extraction Prompt Engineering (3 pts)
  # GPT: Updated prompts, examples, testing, accuracy metrics
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-10/stories/story-10.10-extraction-prompts.md
  # CONTEXT 2025-12-04: Context file at docs/sprint-artifacts/epics/epic-10/stories/10-10-extraction-prompts.context.xml
  # IMPLEMENTED 2025-12-04: Few-shot examples, graceful null handling, test corpus, 14 accuracy tests
    # CODE REVIEWED 2025-12-04: APPROVED - 5/7 ACs verified, 2 deferred to accuracy testing
  10-10-extraction-prompts: done
  # Story 10.11: Testing & Migration (2 pts)
  # QA: Backward compatibility, schema migration, validation, performance
  # NOTE: Review Story 10.12 - adds extraction_data JSONB, extraction_version columns to documents table
  # NOTE: 10.12 already verified backward compat, 1346 tests pass, QA validated extraction
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-10/stories/story-10.11-testing-migration.md
  # CONTEXT 2025-12-04: docs/sprint-artifacts/epics/epic-10/stories/10-11-testing-migration.context.xml
  # IMPLEMENTED 2025-12-04: All 8 tasks complete
  # - Task 1: v1/v2/v3 extraction fixtures created
  # - Task 2: Schema validation (44 tests verified)
  # - Task 3: Gap analysis tests (33 tests verified)
  # - Task 4: UI component tests (67 tests) - EndorsementMatrix, PremiumBreakdownTable, CollapsibleSection
  # - Task 5: E2E test suite created (epic-10-extraction.spec.ts)
  # - Task 6: Performance timeouts verified in code
  # - Task 7: Build verification - 1481 tests pass, build OK, tsc OK, ESLint warnings only
  # - Task 8: CLAUDE.md updated with Epic 10 patterns
  10-11-testing-migration: done
  # Story 10.12: Extraction at Upload Time (3 pts) - NEW 2025-12-04
  # Trigger extraction in process-document Edge Function after chunking
  # Store in documents.extraction_data JSONB, enable chat structured data, source citations
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-10/stories/story-10.12-extraction-at-upload-time.md
  # IMPLEMENTED 2025-12-04: All 9 ACs complete
  # - Edge Function Step 9: GPT-5.1 extraction after AI tagging (60s timeout)
  # - Database: extraction_data JSONB, extraction_version, extraction_error columns
  # - Chat RAG: getStructuredExtractionData(), formatStructuredContext(), buildPromptWithStructuredData()
  # - Comparison: Cache hit/miss logic with version check
  # - Document Library: Carrier/premium display from extraction_data
  # - QA Validated: 32 coverages, 12 exclusions extracted from test document
  # CODE REVIEWED 2025-12-04: APPROVED - all 9 ACs verified, 10 unit tests, 1346 total tests pass
  10-12-extraction-at-upload-time: done
  # RETROSPECTIVE 2025-12-04: docs/sprint-artifacts/retrospectives/epic-10-retrospective.md
  # Key learnings: OpenAI structured output schema requirements, trigger vs execution timeout
  # 504 timeout issue identified - leads to Epic 11
  # Grade: A- (B+ for process due to 504 discovery post-completion)
  epic-10-retrospective: completed

# ===========================================
# EPIC 11: PROCESSING RELIABILITY & ENHANCED PROGRESS
# ===========================================
# Source: Epic 10 Retrospective - 2025-12-04
# Reason: 504 timeout errors after Story 10.12 extended processing to 100-250s
# Root Cause: HTTP trigger timeout (~150s) < processing time
# Solution: Async processing with pg_cron + enhanced progress UI
# Doc: docs/epics/epic-11-processing-reliability-enhanced-progress.md
# Total Points: 15 (5 stories)

  # Epic 11: Processing Reliability & Enhanced Progress Visualization
  # RETROSPECTIVE 2025-12-05: docs/sprint-artifacts/retrospectives/epic-11-retrospective.md
  # Key finding: Async architecture works, but Docling is the bottleneck (150+ second hangs)
  # Decision: Replace Docling with Google Cloud Document AI (Epic 12)
  # Grade: B- (good delivery, but didn't solve root cause)
  # PHASE 2 ADDED 2025-12-05: Stories 11.6-11.8 for phased processing optimization
  # Reason: 30+ page docs take 60+ seconds; split into fast-chat + background extraction
  epic-11: contexted
  epic-11-retrospective: completed
  # Story 11.1: Async Processing Architecture (5 pts)
  # pg_cron job queue, processing_jobs table, Edge Function modification
  # Priority: P0 - foundation for reliability
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-11/stories/story-11.1-async-processing-architecture.md
  # CONTEXT 2025-12-04: Context file at docs/sprint-artifacts/epics/epic-11/stories/11-1-async-processing-architecture.context.xml
  # IMPLEMENTED 2025-12-04: Database migrations, service.ts, Edge Function modifications
  # - pg_cron + pg_net extensions enabled
  # - processing_jobs columns: agency_id, stage, progress_percent, retry_count
  # - process_next_document_job() function with SKIP LOCKED
  # - Upload returns immediately (no sync Edge Function trigger)
  # - Edge Function accepts job_id, updates stage/progress_percent columns
  # CODE REVIEWED 2025-12-04: APPROVED - 6/6 ACs verified, 5/5 tasks verified
  # Migrations: async_processing_infrastructure + job_processor_function
  # pg_cron triggers Edge Function every minute via pg_net
  11-1-async-processing-architecture: done
  # Story 11.2: Enhanced Progress Bar UI (3 pts)
  # True percentage, stage visualization, elapsed time, realtime updates
  # Priority: P0 - user visibility
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-11/stories/story-11.2-enhanced-progress-bar-ui.md
  # IMPLEMENTED 2025-12-04: All 6 ACs complete
  # - Enhanced processing-progress.tsx with queued/analyzing stages
  # - use-processing-progress.ts updated with JobMetadata, QueueInfo, direct column reading
  # - Queue position via get_queue_position RPC
  # - Failed/success states with retry button
  # - All required data-testid attributes
  # - 1481 tests pass
  # CODE REVIEWED 2025-12-05: APPROVED - all 6 ACs verified, all 6 tasks complete, solid implementation
  11-2-enhanced-progress-bar-ui: done
  # Story 11.3: Reliable Job Recovery (3 pts)
  # Stuck job detection, automatic retry, max retries, manual retry
  # Priority: P1 - reliability
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-11/stories/story-11.3-reliable-job-recovery.md
  # CONTEXT 2025-12-05: Context file at docs/sprint-artifacts/epics/epic-11/stories/11-3-reliable-job-recovery.context.xml
  11-3-reliable-job-recovery: done
  # Story 11.4: Processing Queue Visualization (2 pts)
  # Queue position, estimated wait time, queue summary
  # Priority: P1 - user visibility
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-11/stories/story-11.4-processing-queue-visualization.md
  # IMPLEMENTED 2025-12-05: ProcessingQueueSummary component, documents page integration
  # Task 1 & 2 already implemented in useProcessingProgress hook
  # Task 3: New ProcessingQueueSummary component with collapsible details
  # Task 4: Integrated into documents page header
  # 12 unit tests + E2E spec, 1514 total tests pass
  # CODE REVIEWED 2025-12-05: APPROVED - all 4 ACs verified, 16/16 tasks complete
  11-4-processing-queue-visualization: done
  # Story 11.5: Error Handling & User Feedback (2 pts)
  # Error classification, user-friendly messages, toast notifications
  # Priority: P1 - user experience
  # DRAFTED 2025-12-04: Story file at docs/sprint-artifacts/epics/epic-11/stories/story-11.5-error-handling-user-feedback.md
  # CONTEXT 2025-12-05: Context file at docs/sprint-artifacts/epics/epic-11/stories/11-5-error-handling-user-feedback.context.xml
  # IMPLEMENTED 2025-12-05: All 5 ACs complete
  # - Error classification service with transient/recoverable/permanent categories
  # - User-friendly messages with suggested actions (no technical jargon)
  # - Toast notifications via useFailureNotifications hook (Supabase Realtime)
  # - Error tooltips in DocumentStatusBadge with classified messages
  # - ProcessingQueueSummary with clickable failed count filter
  # CODE REVIEWED 2025-12-05: All tasks complete, 1514 tests pass
  11-5-error-handling-user-feedback: done
  # Story 11.6: Phased Document Processing - Fast Chat Path (5 pts)
  # Split processing into Phase 1 (chat) and Phase 2 (extraction)
  # Priority: P0 - enables faster time-to-chat for large documents
  # DRAFTED 2025-12-05: Story file at docs/sprint-artifacts/epics/epic-11/stories/11-6-phased-processing-fast-chat/
  # CONTEXT 2025-12-05: Context file at docs/sprint-artifacts/epics/epic-11/stories/11-6-phased-processing-fast-chat/11-6-phased-processing-fast-chat.context.xml
  # IMPLEMENTED 2025-12-05: Phased processing with extract-quote-data Edge Function, all 1554 tests pass
  # CODE REVIEWED 2025-12-05: APPROVED - all 6 ACs verified, all 6 tasks verified, excellent implementation
  11-6-phased-processing-fast-chat: done
  # Story 11.7: Comparison Page - Extraction Status Handling (3 pts)
  # Show "Analyzing" banner when extraction pending, suggest chat alternative
  # Priority: P0 - UX for phased processing
  # DRAFTED 2025-12-05: Story file at docs/sprint-artifacts/epics/epic-11/stories/11-7-comparison-extraction-status/
  # CONTEXT 2025-12-05: Context file at docs/sprint-artifacts/epics/epic-11/stories/11-7-comparison-extraction-status/11-7-comparison-extraction-status.context.xml
  # Story 11.7: Comparison Page - Extraction Status Handling
  # IMPLEMENTED 2025-12-05: All 6 ACs complete
  # - ExtractionPendingBanner with estimated time, chat alternative link
  # - useExtractionStatus hook for Realtime subscription
  # - QuoteSelector cards show extraction indicators (checkmark/spinner/alert)
  # - Retry button for failed extractions via /api/documents/[id]/retry
  # - 29 unit tests + E2E spec, 1583 total tests pass
  # CODE REVIEWED 2025-12-05: CHANGES REQUESTED
  # - [Med] Banner flash on first document selection - race condition in useExtractionStatus
  # - [Low] Selection counter doesn't show "X ready, Y analyzing" breakdown
  # BUG FIX 2025-12-05: Added isLoading state to useExtractionStatus hook
  # - Prevents race condition where statusMap is empty on first document click
  # - While loading, treats documents as pending to prevent banner flash
  # - All 410 compare-related tests pass, build successful
  11-7-comparison-extraction-status: done
  # Story 11.8: Document List - Extraction Status Indicators (2 pts)
  # Show extraction badges on document cards and table
  # Priority: P1 - visibility for extraction status
  # DRAFTED 2025-12-05: Story file at docs/sprint-artifacts/epics/epic-11/stories/11-8-document-list-extraction-indicators/
  # CONTEXT 2025-12-05: Context file at docs/sprint-artifacts/epics/epic-11/stories/11-8-document-list-extraction-indicators/11-8-document-list-extraction-indicators.context.xml
  # IMPLEMENTED 2025-12-05: All 6 tasks complete, 24 unit tests, E2E spec
  # CODE REVIEWED 2025-12-05: APPROVED - 5/5 ACs verified, 24/24 tasks verified, 1607 tests pass
  11-8-document-list-extraction-indicators: done

# ===========================================
# EPIC 12: GOOGLE CLOUD DOCUMENT AI MIGRATION
# ===========================================
# Source: Epic 11 Retrospective - 2025-12-05
# Reason: Docling hangs for 150+ seconds on complex insurance PDFs
# Evidence: foran auto nationwide.pdf (1.3MB) stuck at 5% for 10+ minutes
# Solution: Replace Docling with Google Cloud Document AI
# Cost: ~$1.50 per 1000 pages (~$0.08 per typical document)
# Expected: 5-30 second processing vs 150+ seconds
# Doc: docs/epics/epic-12-document-ai-migration.md (TBD)
# Total Points: 15 (5 stories)
# NOTE: After Epic 12 complete, Sam can CANCEL RAILWAY ACCOUNT (Docling service)

  # Epic 12: Google Cloud Document AI Migration
  # ABANDONED 2025-12-06: Too complex for serverless environment
  # Root cause: Batch processing has GCS dependency, sharding, memory limits
  # 7 critical bugs in Story 12.6 alone, final error "Failed to process all documents"
  # Decision: Migrate to LlamaParse instead (Epic 13)
  # Retrospective: docs/sprint-artifacts/epics/epic-12/epic.md
  epic-12: abandoned
  # Story 12.1: Connect GCP Document AI (2 pts)
  # Sam has created GCP instance - needs help connecting
  # Priority: P0 - foundation
  # CONTEXT 2025-12-05: Context file at docs/sprint-artifacts/epics/epic-12/stories/12-1-connect-gcp-document-ai.context.xml
  # IMPLEMENTED 2025-12-05: JWT auth with Web Crypto API, token caching, error classification
  # CODE REVIEWED 2025-12-05: APPROVED - 12/12 ACs verified, excellent code quality
  12-1-connect-gcp-document-ai: done
  # Story 12.2: Create Document AI Parsing Service (3 pts)
  # TypeScript service wrapping Document AI API
  # Priority: P0 - core service
  # DRAFTED 2025-12-05: Story file at docs/sprint-artifacts/epics/epic-12/stories/story-12.2-document-ai-parsing-service.md
  # CONTEXT 2025-12-05: Context file at docs/sprint-artifacts/epics/epic-12/stories/12-2-document-ai-parsing-service.context.xml
  12-2-document-ai-parsing-service: done
  # Story 12.3: Integrate into Edge Function (5 pts)
  # Replace Docling call with Document AI call
  # Priority: P0 - main integration
  # IMPLEMENTED 2025-12-05: All 5 ACs complete
  # - AC-12.3.1: parseDocument() replaced with Document AI call
  # - AC-12.3.2: parseDocumentWithRetry() wrapper updated, returns DoclingResult
  # - AC-12.3.3: Progress updates continue at parsing stage (0%, 100%)
  # - AC-12.3.4: Error classification via classifyDocumentAIError()
  # - AC-12.3.5: All Docling-specific code removed, deprecation warning added
  # - Build passes, 1554 tests pass
  # CODE REVIEWED 2025-12-05: APPROVED - all 5 ACs verified, excellent code quality
  12-3-edge-function-integration: done
  # Story 12.4: Response Parsing (3 pts)
  # Convert Document AI response to our internal format
  # Priority: P0 - data compatibility
  # DRAFTED 2025-12-05: Story file at docs/sprint-artifacts/epics/epic-12/stories/12-4-response-parsing/12-4-response-parsing.md
  12-4-response-parsing: done
  # Story 12.5: Testing & Validation (2 pts)
  # Test with foran auto nationwide.pdf and diverse documents
  # Priority: P0 - quality gate
  # IMPLEMENTED 2025-12-06: All 5 ACs verified
  # - AC-12.5.1: Real documents process in 8-21 seconds (vs 150+ with Docling)
  # - AC-12.5.2: 1607 tests pass
  # - AC-12.5.3: E2E test created at __tests__/e2e/document-ai-processing.spec.ts
  # - AC-12.5.4: Error handling verified via classifyDocumentAIError()
  # - AC-12.5.5: Build passes without errors
  12-5-testing-validation: done
  # Story 12.6: Batch Processing for Large Documents (3 pts)
  # Handle documents > 30 pages using Document AI batch processing API
  # Priority: P1 - essential for enterprise users with lengthy policy documents
  # Note: Online processing has 30-page limit (imageless mode). Batch processing supports up to 500 pages.
  # IMPLEMENTED 2025-12-06: All 8 ACs complete
  # - AC-12.6.1: getPageCount() function - PDF structure parsing
  # - AC-12.6.2: selectProcessingMode() - ≤15 pages → online
  # - AC-12.6.3: >15 pages → batch via GCS
  # - AC-12.6.4: uploadToGCS() for batch input
  # - AC-12.6.5: pollBatchOperation() with 5-min timeout
  # - AC-12.6.6: downloadFromGCS() for results
  # - AC-12.6.7: Batch progress stages in UI (uploading, batch_processing, downloading_results)
  # - AC-12.6.8: GCS bucket lifecycle rule (24h auto-delete) - manually configured
  # Build passes, 1607 tests pass
  # Tested Edgee Function logs for 100+ page document:
    # - Supabase Edge Function logs: {"level":"error","message":"Processing failed","error":"An unexpected error occurred connecting to Document AI.","stack":"Error: An unexpected error occurred connecting to Document AI.\n at parseDocumentWithRetry (file:///var/tmp/sb-compile-edge-runtime/process-document/index.ts:648:11)\n at eventLoopTick (ext:core/01_core.js:175:7)\n at async Object.handler (file:///var/tmp/sb-compile-edge-runtime/process-document/index.ts:391:25)\n at async mapped (ext:runtime/http.js:242:18)","documentId":"e1c17293-7b5e-48ae-a45f-733003a5da9d","agencyId":"65dae458-3f91-4f71-96a2-e825f9769a50","errorType":"permanent","errorCategory":"permanent","errorCode":"UNKNOWN","isRetryable":false,"step":"unknown","timestamp":"2025-12-06T08:14:21.147Z"}
    # 
  # Story 12.6: ABANDONED - 7 bugs encountered, fundamental incompatibility with Edge Functions
  # Memory limits (~150MB), sharding complexity, GCS dependency, format mismatches
  12-6-batch-processing-large-documents: abandoned

# ===========================================
# EPIC 13: LLAMAPARSE MIGRATION
# ===========================================
# Source: Epic 12 Abandonment - 2025-12-06
# Reason: Document AI batch processing fundamentally incompatible with Edge Functions
# Solution: LlamaParse - simple REST API, 10K free pages/month, no GCS/sharding
# Doc: docs/sprint-artifacts/epics/epic-13/epic.md
# Tech Spec: docs/sprint-artifacts/epics/epic-13/tech-spec/tech-spec-epic-13.md
# Total Points: 10 (4 stories)

  # Epic 13: LlamaParse Migration
  # COMPLETE 2025-12-07: All 4 stories done (13.1, 13.2, 13.3, 13.4), migration validated
  # RETROSPECTIVE 2025-12-07: docs/sprint-artifacts/retrospectives/epic-13-retrospective.md
  # Key learnings: "Juice vs squeeze" pivot decision, simple > enterprise for serverless
  # Grade: A - Successful pivot from failed Epic 12, clean delivery
  epic-13: done
  epic-13-retrospective: completed
  # Story 13.1: LlamaParse API Client (3 pts)
  # Create TypeScript client for LlamaParse API
  # Priority: P0 - foundation
  # DRAFTED 2025-12-06: Story file at docs/sprint-artifacts/epics/epic-13/stories/13-1-llamaparse-api-client/
  # CONTEXT 2025-12-06: Context file at docs/sprint-artifacts/epics/epic-13/stories/13-1-llamaparse-api-client/13-1-llamaparse-api-client.context.xml
  # IMPLEMENTED 2025-12-06: All 7 ACs complete
  # - AC-13.1.1: Client module structure (llamaparse-client.ts)
  # - AC-13.1.2: File upload with page_prefix config
  # - AC-13.1.3: Job polling (2s interval, 5min timeout)
  # - AC-13.1.4: Result retrieval
  # - AC-13.1.5: DoclingResult conversion with PageMarker indices
  # - AC-13.1.6: Error handling with retry/backoff
  # - AC-13.1.7: Page marker fallback for {pageNumber} bug
  # 24 unit tests pass, 1631 total tests pass, build successful
  13-1-llamaparse-api-client: done
  # Story 13.2: Edge Function Integration (3 pts)
  # Replace Docling/Document AI calls with LlamaParse
  # Priority: P0 - core integration
  # DRAFTED 2025-12-06: Story file at docs/sprint-artifacts/epics/epic-13/stories/13-2-edge-function-integration/
  # CONTEXT 2025-12-06: Context file at docs/sprint-artifacts/epics/epic-13/stories/13-2-edge-function-integration/13-2-edge-function-integration.context.xml
  # IMPLEMENTED 2025-12-06: All 5 ACs complete
  # - AC-13.2.1: parseDocumentWithLlamaParse imported and called
  # - AC-13.2.2: Progress callback at 0-100% during parsing stage
  # - AC-13.2.3: classifyLlamaParseError() maps to existing categories
  # - AC-13.2.4: convertToDoclingResult() maintains backward compatibility
  # - AC-13.2.5: LLAMA_CLOUD_API_KEY validated at startup
  # CODE REVIEWED 2025-12-06: APPROVED - all 5 ACs verified, 1631 tests pass
  13-2-edge-function-integration: done
  # Story 13.3: Remove Document AI Code (2 pts)
  # Clean up abandoned Epic 12 code + Docling code
  # Priority: P1 - technical debt
  # DRAFTED 2025-12-06: Story file at docs/sprint-artifacts/epics/epic-13/stories/13-3-remove-document-ai/
  # CONTEXT 2025-12-06: Context file at docs/sprint-artifacts/epics/epic-13/stories/13-3-remove-document-ai/13-3-remove-document-ai.context.xml
  # IMPLEMENTED 2025-12-06: All code removed, build+tests pass (1564 tests)
  # CODE REVIEWED 2025-12-06: APPROVED - 10/10 ACs verified, 13/13 tasks verified, 1564 tests pass
  13-3-remove-document-ai: done
  # Story 13.4: Testing & Validation (2 pts)
  # End-to-end testing with 126-page PDF and other documents
  # Priority: P0 - quality gate
  # DRAFTED 2025-12-06: Story file at docs/sprint-artifacts/epics/epic-13/stories/13-4-testing-validation/
  # CONTEXT 2025-12-07: Context file at docs/sprint-artifacts/epics/epic-13/stories/13-4-testing-validation/13-4-testing-validation.context.xml
  # DONE 2025-12-07: Manual testing completed by Sam - all ACs verified, LlamaParse migration validated
  13-4-testing-validation: done

# ===========================================
# EPIC 14-20: AI BUDDY FEATURE
# ===========================================
# Source: AI Buddy PRD + Architecture + UX Design - 2025-12-07
# Reason: Personalized AI assistant for independent insurance agents
# Planning Docs: docs/features/ai-buddy/

# Total: 7 Epics, 55 Stories, 64 FRs covered
# FR33-34 (carrier restrictions) deferred to Quoting feature

  # Epic 14: AI Buddy Foundation
  # Goal: Database schema, API routes, navigation integration
  # FRs: FR63
  # Tech Spec: docs/sprint-artifacts/epics/epic-14/tech-spec.md
  # COMPLETE 2025-12-07: All 5 stories done (14.1-14.5)
  # Note: Story 14.4 changed from dark to light theme per user request
  epic-14-ai-buddy-foundation: done
  # Story 14.1: AI Buddy Database Schema
  # Create 8 tables, indexes, RLS policies, enums for AI Buddy feature
  # DRAFTED 2025-12-07: Story file at docs/sprint-artifacts/epics/epic-14/stories/14-1-database-schema/14-1-database-schema.md
  # CONTEXT 2025-12-07: Context file at docs/sprint-artifacts/epics/epic-14/stories/14-1-database-schema/14-1-database-schema.context.xml
  14-1-database-schema: done
  14-2-api-route-structure: done
  14-3-navigation-integration: done
  # Story 14.4: Changed from dark to light theme per user request
  14-4-page-layout-shell: done
  # Story 14.5: 21 components + 5 hooks created with TypeScript interfaces
  # Build passes, TypeScript passes, shadcn switch component added
  14-5-component-scaffolding: done
  # RETROSPECTIVE 2025-12-07: docs/sprint-artifacts/retrospectives/epic-14-retrospective.md
  # Key takeaways: Tech specs enable epic-yolo, foundation epics low-risk/high-value
  # Grade: A - 5/5 stories, clean execution, enables Epic 15-20 development
  epic-14-retrospective: completed

  # Epic 15: AI Buddy Core Chat
  # Goal: Conversational AI with streaming, citations, confidence
  # FRs: FR1, FR2, FR5, FR7, FR8, FR9, FR10
  # Tech Spec: docs/sprint-artifacts/epics/epic-15/tech-spec.md
  # Total Points: 37 (7 stories)
  # CONTEXTED 2025-12-07: Tech spec complete with story breakdown
  epic-15-ai-buddy-core-chat: contexted
  15-1-chat-input-component: done
  15-2-message-display: backlog
  15-3-streaming-chat-api: backlog
  15-4-conversation-persistence: backlog
  15-5-source-citations: backlog
  15-6-confidence-indicators: backlog
  15-7-guardrail-aware-responses: backlog

  # Epic 16: AI Buddy Projects
  # Goal: Organize work by client accounts with persistent document context
  # FRs: FR3, FR4, FR6, FR11-19
  epic-16-ai-buddy-projects: backlog
  16-1-create-project: backlog
  16-2-project-sidebar: backlog
  16-3-project-context: backlog
  16-4-rename-archive-projects: backlog
  16-5-conversation-history: backlog
  16-6-search-conversations: backlog
  16-7-delete-conversations: backlog
  16-8-general-chat: backlog
  16-9-move-conversation-to-project: backlog

  # Epic 17: AI Buddy Document Intelligence
  # Goal: Document upload, processing, AI-powered context
  # FRs: FR20-25, FR65, FR66
  epic-17-ai-buddy-document-intelligence: backlog
  17-1-document-upload-conversation: backlog
  17-2-document-upload-project: backlog
  17-3-document-processing-status: backlog
  17-4-document-preview: backlog
  17-5-multi-document-context: backlog
  17-6-remove-project-documents: backlog
  17-7-documine-document-integration: backlog

  # Epic 18: AI Buddy Personalization & Onboarding
  # Goal: Personalized AI experience from first interaction
  # FRs: FR26-32, FR57-62
  epic-18-ai-buddy-personalization-onboarding: backlog
  18-1-onboarding-flow: backlog
  18-2-skip-onboarding: backlog
  18-3-user-preferences-management: backlog
  18-4-agency-information: backlog
  18-5-preference-aware-responses: backlog
  18-6-reset-preferences: backlog
  18-7-guided-first-conversation: backlog
  18-8-admin-onboarding-status: backlog

  # Epic 19: AI Buddy Guardrails & Compliance
  # Goal: Admin-controlled guardrails for E&O protection
  # FRs: FR35-41
  epic-19-ai-buddy-guardrails-compliance: backlog
  19-1-restricted-topics-configuration: backlog
  19-2-guardrail-rules-toggle: backlog
  19-3-immediate-guardrail-effect: backlog
  19-4-guardrail-enforcement-logging: backlog
  19-5-invisible-guardrail-responses: backlog
  19-6-ai-disclosure-message: backlog

  # Epic 20: AI Buddy Admin & Audit
  # Goal: User management, analytics, audit trail for compliance
  # FRs: FR42-56, FR64
  epic-20-ai-buddy-admin-audit: backlog
  20-1-admin-user-list: backlog
  20-2-invite-users: backlog
  20-3-remove-users: backlog
  20-4-change-user-roles: backlog
  20-5-usage-analytics: backlog
  20-6-usage-dashboard-trends: backlog
  20-7-audit-log-view: backlog
  20-8-audit-log-transcript-view: backlog
  20-9-audit-log-export: backlog
  20-10-audit-log-immutability: backlog
  20-11-owner-billing-management: backlog
  20-12-transfer-ownership: backlog
  20-13-feature-navigation-polish: backlog
