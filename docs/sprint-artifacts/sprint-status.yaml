# generated: 2025-11-28
# project: sams-tool
# tracking_system: file-system
# story_location: '{project-root}/docs/sprint-artifacts'

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic exists in epic file but not contexted
#   - contexted: Next epic tech context created by *epic-tech-context (required)
#   - future: Deferred post-MVP work (tracked but not scheduled)
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - drafted: Story file created in stories folder by *create-story
#   - ready-for-dev: Draft approved and story context created by *story-ready
#   - in-progress: Developer actively working on implementation by *dev-story
#   - review: Implementation complete, ready for review by *code-review
#   - done: Story completed by *story-done
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - completed: Retrospective has been done by *retrospective
#
# WORKFLOW NOTES:
# ===============
# - Epics should be 'contexted' before stories can be 'drafted'
# - SM typically drafts next story ONLY after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', dev reviews, then Dev moves to 'done'

generated: 2025-11-28
project: sams-tool
tracking_system: file-system
story_location: '{project-root}/docs/sprint-artifacts'

development_status:
  # Epic 1: Foundation & Infrastructure
  epic-1: done
  1-1-project-initialization-core-setup: done
  1-2-database-schema-rls-policies: done
  1-3-supabase-client-configuration: done
  1-4-storage-bucket-configuration: done
  1-5-error-handling-logging-patterns: done
  1-6-deployment-pipeline-setup: done
  epic-1-retrospective: completed

  # Pre-Epic Technical Debt (Must complete before Epic 2)
  0-1-test-framework-setup: done

  # Epic 2: User Authentication & Onboarding
  epic-2: done
  2-1-signup-page-agency-creation: done
  2-2-post-signup-agency-user-record-creation: done
  2-3-login-page: done
  2-4-session-management-auth-middleware: done
  2-5-password-reset-flow: done
  2-6-user-profile-management: done
  epic-2-retrospective: done

  # Epic 3: Agency & Team Management
  epic-3: done
  3-1-agency-settings-page: done
  3-2-invite-users-to-agency: done
  3-3-manage-team-members: done
  3-4-subscription-billing-management: done
  3-5-agency-usage-metrics: done
  3-6-settings-ux-enhancements: done
  epic-3-retrospective: completed

  # Epic 4: Document Upload & Management
  epic-4: done
  4-1-document-upload-zone: done
  4-2-upload-progress-status-feedback: done
  4-3-document-list-view: done
  4-4-delete-documents: done
  4-5-document-organization-rename-label: done
  4-6-document-processing-pipeline-llamaparse: done
  4-7-processing-queue-management: done
  # Story 4.8 added post-retrospective based on LlamaParse issues (2025-11-30)
  4-8-migrate-document-processing-to-docling: done
  epic-4-retrospective: completed

  # Epic 5: Document Q&A with Trust Transparency
  epic-5: done
  5-1-chat-interface-layout-split-view: done
  5-2-natural-language-query-input: done
  5-3-ai-response-with-streaming-trust-elements: done
  5-4-source-citation-display: done
  5-5-document-viewer-with-highlight-navigation: done
  5-6-conversation-history-follow-up-questions: done
  5-7-responsive-chat-experience: done
  # Stories 5.8-5.10 added based on RAG optimization research (2025-12-01)
  # Story files drafted with full specifications
  5-8-retrieval-quality-optimization: done
  # Story 5.8.1 added as bug fix (2025-12-02)
  # Fixes large document processing timeouts and adds file size validation
  # REVIEWED 2025-12-02: Approved - test fix applied during review
  5-8-1-large-document-processing: done
  5-9-chunking-optimization: done
  5-10-model-evaluation: done
  # Story 5.11 added as bug fix (2025-12-01)
  # Fixes streaming memory leaks, AI personality, and greeting handling
  5-11-streaming-ai-personality-bugfix: done
  # Story 5.12 added as enhancement (2025-12-02)
  # Visual progress tracking for document processing
  # UX Design COMPLETE (Party Mode 2025-12-02), Context validated 2025-12-02
  # Infrastructure fix applied 2025-12-02: Realtime + RLS policy for client access
  # CODE REVIEWED 2025-12-02: Approved - clean implementation, all AC met
  5-12-processing-progress-visualization: done
  # Story 5.13 added as bug fix (2025-12-02)
  # Docling PDF parsing robustness - handles libpdfium page-dimensions errors
  # Context created 2025-12-02: 5-13-docling-pdf-robustness.context.xml
  # IMPLEMENTED 2025-12-02: Phase 1 (P0) + Phase 2 (P1) complete
  # Phase 3 (pypdfium2 backend) deferred to Future Epic F3
  # CODE REVIEWED 2025-12-02: APPROVED - all ACs verified, all tasks complete
  5-13-docling-pdf-robustness: done
  # Story 5.14 added as polish (2025-12-02)
  # Fixes progress jumping and delete not reflecting in realtime
  # Context created 2025-12-02: 5-14-realtime-polish.context.xml
  # IMPLEMENTED 2025-12-02: Monotonic progress, optimistic delete, connection indicator
  # CODE REVIEWED 2025-12-02: APPROVED - all ACs verified
  5-14-realtime-polish: done
  # Mini-retro (5.1-5.6) completed 2025-12-01: docs/sprint-artifacts/epic-5-retro-2025-12-01.md
  # Doc update session completed 2025-12-02 (Party Mode - epics.md, architecture.md)
  # FULL Epic 5 retrospective completed 2025-12-02: docs/sprint-artifacts/epic-5-full-retrospective.md
  # Identified 4 bugs requiring cleanup before proceeding to Quote Comparison
  epic-5-retrospective: completed

  # Epic 6: Epic 5 Cleanup & Stabilization + UI Polish
  # Source: Epic 5 Full Retrospective + Party Mode UI Exploration - 2025-12-02
  # Reason: 4 bugs + 5 UI polish items undermining trust transparency UX
  # Tech Spec: docs/sprint-artifacts/tech-spec-epic-6.md
  # Research: docs/research-ui-best-practices-2025-12-02.md
  epic-6: done
  # Story 6.1: Fix Conversation Loading (406 Error)
  # RLS policy allows INSERT but not SELECT - users can't load their conversations
  # Priority: P0 - blocks other testing
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/story-6.1-fix-conversation-loading-406.md
  # CONTEXT 2025-12-02: Context file created at docs/sprint-artifacts/6-1-fix-conversation-loading-406.context.xml
  # IMPLEMENTED 2025-12-02: Fixed .single() to .maybeSingle(), Playwright E2E test added
  # CODE REVIEWED 2025-12-02: APPROVED - all ACs verified, all tasks complete
  6-1-fix-conversation-loading-406: done
  # Story 6.2: Fix Confidence Score Calculation
  # Cohere reranker scores replace vector similarity - wrong thresholds
  # Priority: P0 - core trust feature broken
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/story-6.2-fix-confidence-score-calculation.md
  # CONTEXT 2025-12-02: Context file created at docs/sprint-artifacts/6-2-fix-confidence-score-calculation.context.xml
  # Party Mode verified: rerankerScore exists, bug at reranker.ts:114, one-line deletion + confidence update
  # IMPLEMENTED 2025-12-02: Fixed reranker.ts bug, dual-threshold logic, conversational badge
  # CODE REVIEWED 2025-12-02: APPROVED - all 6 ACs verified, all 6 tasks verified complete
  6-2-fix-confidence-score-calculation: done
  # Story 6.3: Fix Source Citation Navigation
  # Clicking citation doesn't scroll PDF to referenced page
  # Priority: P1 - UX broken but not blocking
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/story-6.3-fix-source-citation-navigation.md
  # CONTEXT 2025-12-02: Context file created at docs/sprint-artifacts/6-3-fix-source-citation-navigation.context.xml
  # IMPLEMENTED 2025-12-03: Fixed dual-instance rendering, scrollToPage with getBoundingClientRect
  # Root cause: TWO DocumentViewer instances in DOM, ref attached to hidden one
  # Fix: Conditional rendering with useIsMobile() hook - only ONE instance exists
  # CODE REVIEWED 2025-12-03: APPROVED - all 5 ACs verified, architectural fix correct
  6-3-fix-source-citation-navigation: done
  # Story 6.4: DEFERRED to Future Epic F4
  # Moved 2025-12-02: Mobile optimization not priority for MVP
  # See: epic-f4-mobile-optimization
  # Story 6.5: Remove Stale UI Text & Fix Page Title (NEW - UI Polish)
  # "Coming in Epic 5" text and "Create Next App" page title
  # Priority: P0 - embarrassment fix, XS effort
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/story-6.5-remove-stale-text-fix-title.md
  # IMPLEMENTED 2025-12-02: Fixed page title, removed stale Epic references, dynamic doc titles
  6-5-remove-stale-text-fix-title: done
  # Story 6.6: Connection Status & Realtime Indicator (NEW - UI Polish)
  # "Connecting..." never resolves to meaningful state
  # Priority: P1 - user feedback improvement, S effort
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/story-6.6-connection-status-indicator.md
  # CONTEXT 2025-12-02: Context file created at docs/sprint-artifacts/6-6-connection-status-indicator.context.xml
  6-6-connection-status-indicator: done
  # Story 6.7: Document List UX Polish (COMBINED - UI Polish)
  # Combined 2025-12-02: Merged original 6.7, 6.8, 6.9 into single story
  # Includes: selection highlight, empty state UX, filename tooltips
  # Priority: P1 - UX polish, M effort (3-4 hours combined)
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/story-6.7-document-list-ux-polish.md
  # CONTEXT 2025-12-02: Context file created at docs/sprint-artifacts/6-7-document-list-ux-polish.context.xml
  # IMPLEMENTED 2025-12-02: Selection highlight, empty states, filename tooltips
  # 19 unit tests pass, E2E test created
  # CODE REVIEWED 2025-12-03: Approved and merged
  6-7-document-list-ux-polish: done
  # Story 6.8: Design System Refresh (NEW - Visual Polish)
  # User feedback: "Too grey, doesn't feel modern"
  # Introduces brand accent color, fixes spacing, modernizes look
  # Priority: P1 - UX enhancement, M effort (4-6 hours)
  # DRAFTED 2025-12-02: Story file created at docs/sprint-artifacts/story-6.8-design-system-refresh.md
  # CONTEXT 2025-12-03: Context file created at docs/sprint-artifacts/6-8-design-system-refresh.context.xml
  # PHASE 1 DONE 2025-12-03: Electric Blue accent, button hover effects, spacing fixes, dark mode
  # PHASE 2 DONE 2025-12-03: UX Audit enhancements - 12 ACs implemented
  # Phase 2 includes: resizable panels, markdown chat, dockable chat
  # Phase 2 includes: mobile header fix, nav active state, auth page visuals, card depth
  # AC-6.8.18 (Source Text Highlighting) moved to Future Epic F5
  # CODE REVIEWED 2025-12-03: APPROVED - All ACs verified, ready to merge
  6-8-design-system-refresh: done
  # RETROSPECTIVE 2025-12-03: docs/sprint-artifacts/epic-6-full-retrospective.md
  # Key learnings: Supabase .maybeSingle(), score semantics, conditional rendering
  # All Epic 5 bugs fixed, Design System Refresh complete, A- grade
  epic-6-retrospective: completed

  # Epic 7: Quote Comparison (RENUMBERED from Epic 6)
  # Moved to Epic 7 to allow Epic 5 cleanup first
  # Tech Spec: docs/sprint-artifacts/tech-spec-epic-7.md
  epic-7: contexted
  # Story 7.1: Quote Selection Interface
  # Foundation for comparison feature: selection UI + database migrations
  # Priority: P0 - foundation for all other Epic 7 stories
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/story-7.1-quote-selection-interface.md
  # CONTEXT 2025-12-03: Context file with UX Designer guidance at docs/sprint-artifacts/7-1-quote-selection-interface.context.xml
  # IMPLEMENTED 2025-12-03: All 8 ACs complete, 38 unit tests + E2E tests pass
  # Database: quote_extractions and comparisons tables with RLS policies
  # Components: QuoteSelector, SelectionCounter, /compare page, /compare/[id] page
  # API: POST /api/compare endpoint for creating comparisons
  # CODE REVIEWED 2025-12-03: APPROVED - all 7 ACs verified, security reviewed
  7-1-quote-selection-interface: done
  # Story 7.2: Quote Data Extraction
  # GPT-5.1 structured outputs with zodResponseFormat for data extraction
  # Priority: P0 - core extraction service, all downstream stories depend on this
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/story-7.2-quote-data-extraction.md
  # CONTEXT 2025-12-03: Context file created at docs/sprint-artifacts/7-2-quote-data-extraction.context.xml
  # IMPLEMENTED 2025-12-03: ExtractionService with GPT-5.1 + zodResponseFormat
  # Refactored from function calling to structured outputs for guaranteed schema compliance
  # Types: src/types/compare.ts, Cache: extraction.ts, API: POST+GET /api/compare
  # UI: Comparison result page with polling, extraction cards
  # Tests: 21 unit tests for extraction schema validation
  # Build passes, all 924 tests pass
  # Future consideration: @openai/agents SDK for multi-agent workflows (Epic F8)
  # CODE REVIEWED 2025-12-03: APPROVED - all 8 ACs verified, 21 tests, excellent quality
  7-2-quote-data-extraction: done
  # Story 7.3: Comparison Table View
  # Side-by-side table with difference highlighting, best/worst indicators
  # Priority: P0 - core comparison visualization
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/story-7.3-comparison-table-view.md
  # CONTEXT 2025-12-03: Context file created at docs/sprint-artifacts/7-3-comparison-table-view.context.xml
  # IMPLEMENTED 2025-12-03: DiffEngine + ComparisonTable component
  # 64 unit tests (42 diff + 22 component) + 13 E2E tests (39 across browsers)
  # All ACs (7.3.1-7.3.8) implemented with sticky headers, best/worst indicators, difference highlighting
  # CODE REVIEWED 2025-12-03: APPROVED - all 8 ACs verified, all 7 tasks complete, excellent code quality
  7-3-comparison-table-view: done
  # Story 7.4: Gap & Conflict Identification
  # Automatic detection of coverage gaps and conflicts between quotes
  # Priority: P0 - enhances comparison table with intelligent insights
  # DRAFTED 2025-12-03: Story file created
  # CONTEXT 2025-12-03: Context XML generated, ready for development
  # IMPLEMENTED 2025-12-03: All 7 tasks complete, 37 unit tests + E2E spec
  # CODE REVIEWED 2025-12-03: APPROVED - all 6 ACs verified, 59 tests pass, excellent quality
  7-4-gap-conflict-identification: done
  # Story 7.5: Source Citations in Comparison
  # Click-to-verify for any extracted value, reusing document viewer highlight pattern
  # Priority: P0 - trust transparency for comparison data
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/story-7.5-source-citations-in-comparison.md
  # CONTEXT 2025-12-03: Context file at docs/sprint-artifacts/7-5-source-citations-in-comparison.context.xml
  # IMPLEMENTED 2025-12-03: Source links in table cells, SourceViewerModal with DocumentViewer integration
  # Components: source-viewer-modal.tsx, updated comparison-table.tsx with onSourceClick callback
  # Page navigation works, page-level pulse highlight, inferred value indicators with tooltips
  # Note: Full text highlighting requires bounding box data (deferred to Future Epic F3)
  # 39 unit tests pass, E2E spec created at __tests__/e2e/source-citations.spec.ts
  7-5-source-citations-in-comparison: ready-for-review
  7-6-export-comparison-results: backlog
  # Story 7.7: Comparison History (NEW - 2025-12-03)
  # User can view past comparisons, search, delete from history
  # Priority: P1 - UX enhancement, M effort
  # STATUS: UX Designer review required before development
  # DRAFTED 2025-12-03: Story file created at docs/sprint-artifacts/story-7.7-comparison-history.md
  7-7-comparison-history: drafted
  epic-7-retrospective: optional

# ===========================================
# FUTURE EPICS (Prioritized Post-MVP Roadmap)
# ===========================================
# Priority Order (as of 2025-12-03):
# F1 → F2 → F3 → F4 → F5 → F6 → F7 → F8

  # Epic F1: Tech Debt & Optimizations (NEW - 2025-12-03)
  # Source: Post-Epic 7 planning session
  # Reason: Address accumulated tech debt before adding new features
  # Scope: Performance optimization, code cleanup, test coverage gaps
  epic-f1-tech-debt-optimizations: future
  f1-1-test-coverage-gaps: future
  f1-2-performance-profiling-optimization: future
  f1-3-code-cleanup-refactoring: future
  f1-4-dependency-updates-security: future
  f1-5-monitoring-observability: future

  # Epic F2: User Dashboard & Document Intelligence (NEW - 2025-12-03)
  # Source: Sam's feature request - 2025-12-03
  # Reason: Better document organization and AI-powered insights
  # Features:
  #   - Dashboard view showing all user documents
  #   - Document categorization (general vs quote document)
  #   - AI-powered tagging and short blurbs
  #   - General documents excluded from /compare quotes page
  epic-f2-dashboard-document-intelligence: future
  f2-1-dashboard-page-layout: future
  f2-2-document-categorization-schema: future
  f2-3-ai-tagging-summarization: future
  f2-4-filter-general-docs-from-compare: future
  f2-5-tag-management-ui: future

  # Epic F3: Document Viewer Enhancements (was F5)
  # Source: Story 6.8 AC-6.8.18 - 2025-12-03
  # Reason: Requires PDF.js text layer work, significant effort
  epic-f3-document-viewer-enhancements: future
  f3-1-source-text-highlighting: future
  f3-2-text-selection-highlighting: future
  f3-3-search-within-document: future

  # Epic F4: Email Infrastructure (was F1)
  # Source: Epic 2 Retrospective - 2025-11-28
  # Reason: Resend requires custom domain setup
  epic-f4-email-infrastructure: future
  f4-1-custom-domain-setup-verification: future
  f4-2-resend-smtp-integration-supabase-auth: future
  f4-3-professional-email-templates: future
  f4-4-delivery-tracking-analytics: future

  # Epic F5: Billing Infrastructure (was F2)
  # Source: Epic 2 Retrospective - 2025-11-28
  # Reason: Simplify MVP, manual tier assignment sufficient
  epic-f5-billing-infrastructure: future
  f5-1-stripe-or-lemonsqueezy-integration: future
  f5-2-subscription-management-ui: future
  f5-3-payment-processing: future
  f5-4-usage-based-billing: future
  f5-5-self-service-plan-changes: future

  # Epic F6: Document Processing Reliability (was F3)
  # Source: Story 5.13 Implementation - 2025-12-02
  # Reason: ~1-2% of PDFs fail with libpdfium page-dimensions errors
  epic-f6-document-processing-reliability: future
  f6-1-pypdfium2-backend-evaluation: future
  f6-2-multi-backend-fallback-chain: future
  f6-3-pdf-preprocessing-normalization: future

  # Epic F7: Mobile Optimization (was F4)
  # Source: Epic 6 Story 6.4 - 2025-12-02
  # Reason: Mobile optimization not priority for MVP
  epic-f7-mobile-optimization: future
  f7-1-mobile-tab-state-preservation: future
  f7-2-mobile-responsive-polish: future
  f7-3-touch-gesture-improvements: future

  # Epic F8: Multi-Agent Workflows (NEW - 2025-12-03)
  # Source: Story 7.2 Implementation - 2025-12-03
  # Reason: Complex agentic pipelines using @openai/agents SDK
  # Prerequisites: Currently using zodResponseFormat for single-extraction
  # Potential use cases:
  #   - Quote extraction → comparison → reporting pipeline
  #   - Multi-document analysis with specialized agents per coverage type
  #   - Interactive quote negotiation workflows
  # Reference: https://openai.github.io/openai-agents-js/
  epic-f8-multi-agent-workflows: future
  f8-1-agents-sdk-evaluation: future
  f8-2-extraction-comparison-pipeline: future
  f8-3-multi-agent-coordination: future
  f8-4-guardrails-tracing: future
